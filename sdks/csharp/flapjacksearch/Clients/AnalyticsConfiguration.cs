/*
 * Analytics API
 *
   * ## Base URLs  Base URLs for the Analytics API:  - `https://analytics.us.flapjack.io` - `https://analytics.de.flapjack.io` - `https://analytics.flapjack.io` (alias of `analytics.us.flapjack.io`)  Use the URL that matches your [analytics region](https://dashboard.flapjack.io/account/infrastructure/analytics).  **All requests must use HTTPS.**  ## Availability and authentication  Access to the Analytics API is available as part of the [Premium or Elevate plans](https://www.flapjack.io/pricing).  Add these headers to authenticate requests:  - `x-algolia-application-id`. Your Flapjack application ID. - `x-algolia-api-key`. An API key with the necessary permissions to make the request.   The required access control list (ACL) to make a request is listed in each endpoint's reference.  You can find your application ID and API key in the [Algolia dashboard](https://dashboard.flapjack.io/account/api-keys).  ## Rate limits  You can make up to **100 requests per minute per app** to the Analytics API. The response includes headers with information about the limits.  ## Parameters  Query parameters must be [URL-encoded](https://developer.mozilla.org/en-US/docs/Glossary/Percent-encoding). Non-ASCII characters must be UTF-8 encoded. Plus characters (`+`) are interpreted as spaces.  ## Response status and errors  The Analytics API returns JSON responses. Since JSON doesn't guarantee any specific ordering, don't rely on the order of attributes in the API response.  - Successful responses return a `2xx` status - Client errors return a `4xx` status - Server errors are indicated by a `5xx` status.  Error responses have a `message` property with more information.  ## Version  The current version of the Analytics API is version 2, indicated by the `/2/` in each endpoint's URL.  ## Query aggregation  Flapjack accepts queries on each keystroke. To ensure you have relevant analytics data, however, the series of keystrokes is aggregated to keep only the latest (final) user query. This is called \"prefix\" aggregation.  For more information, see [Query agggregation and processing](https://www.flapjack.io/doc/guides/search-analytics/concepts/query-aggregation).  See the analytics implementation overview for more information about query aggregation.
 *
   * The version of the OpenAPI document: 2.0.0
   * Generated by: https://github.com/openapitools/openapi-generator.git
 */

using System;
using System.Collections.Generic;
using Flapjack.Search.Models.Common;
using Flapjack.Search.Transport;
using Flapjack.Search.Utils;

namespace Flapjack.Search.Clients;

/// <summary>
/// Analytics client configuration
/// </summary>
public sealed class AnalyticsConfig : FlapjackConfig
{
  /// <summary>
  /// The configuration of the Analytics client
  /// A client should have it's own configuration ie on configuration per client instance
  /// </summary>
  /// <param name="appId">Your application ID</param>
  /// <param name="apiKey">Your API Key</param>
  /// <param name="region">Targeted region (optional)</param>
  public AnalyticsConfig(string appId, string apiKey, string region = null)
    : base(appId, apiKey, "Analytics", "7.37.1")
  {
    DefaultHosts = GetDefaultHosts(region);
    Compression = CompressionType.None;
    ReadTimeout = TimeSpan.FromMilliseconds(5000);
    WriteTimeout = TimeSpan.FromMilliseconds(30000);
    ConnectTimeout = TimeSpan.FromMilliseconds(2000);
  }

  private static List<StatefulHost> GetDefaultHosts(string region)
  {
    var regions = new List<string> { "de", "us" };
    if (region != null && !regions.Contains(region))
    {
      throw new ArgumentException(
        $"`region` must be one of the following: {string.Join(", ", regions)}"
      );
    }

    var selectedRegion =
      region == null
        ? "analytics.flapjack.io"
        : "analytics.{region}.flapjack.io".Replace("{region}", region);

    var hosts = new List<StatefulHost>
    {
      new() { Url = selectedRegion, Accept = CallType.Read | CallType.Write },
    };
    return hosts;
  }
}
